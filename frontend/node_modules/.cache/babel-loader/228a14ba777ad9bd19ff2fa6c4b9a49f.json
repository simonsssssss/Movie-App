{"ast":null,"code":"import { __assign, __spreadArray } from \"tslib\";\nimport * as React from \"rehackt\";\nimport { useApolloClient } from \"./useApolloClient.js\";\nimport { getSuspenseCache, unwrapQueryRef, updateWrappedQueryRef, wrapQueryRef } from \"../internal/index.js\";\nimport { useRenderGuard } from \"./internal/index.js\";\nimport { useWatchQueryOptions } from \"./useSuspenseQuery.js\";\nimport { canonicalStringify } from \"../../cache/index.js\";\nimport { invariant } from \"../../utilities/globals/index.js\";\nexport function useLoadableQuery(query, options) {\n  if (options === void 0) {\n    options = Object.create(null);\n  }\n  var client = useApolloClient(options.client);\n  var suspenseCache = getSuspenseCache(client);\n  var watchQueryOptions = useWatchQueryOptions({\n    client: client,\n    query: query,\n    options: options\n  });\n  var _a = options.queryKey,\n    queryKey = _a === void 0 ? [] : _a;\n  var _b = React.useState(null),\n    queryRef = _b[0],\n    setQueryRef = _b[1];\n  var internalQueryRef = queryRef && unwrapQueryRef(queryRef);\n  if (queryRef && (internalQueryRef === null || internalQueryRef === void 0 ? void 0 : internalQueryRef.didChangeOptions(watchQueryOptions))) {\n    var promise = internalQueryRef.applyOptions(watchQueryOptions);\n    updateWrappedQueryRef(queryRef, promise);\n  }\n  var calledDuringRender = useRenderGuard();\n  var fetchMore = React.useCallback(function (options) {\n    if (!internalQueryRef) {\n      throw new Error(\"The query has not been loaded. Please load the query.\");\n    }\n    var promise = internalQueryRef.fetchMore(options);\n    setQueryRef(wrapQueryRef(internalQueryRef));\n    return promise;\n  }, [internalQueryRef]);\n  var refetch = React.useCallback(function (options) {\n    if (!internalQueryRef) {\n      throw new Error(\"The query has not been loaded. Please load the query.\");\n    }\n    var promise = internalQueryRef.refetch(options);\n    setQueryRef(wrapQueryRef(internalQueryRef));\n    return promise;\n  }, [internalQueryRef]);\n  var loadQuery = React.useCallback(function () {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n    invariant(!calledDuringRender(), 50);\n    var variables = args[0];\n    var cacheKey = __spreadArray([query, canonicalStringify(variables)], [].concat(queryKey), true);\n    var queryRef = suspenseCache.getQueryRef(cacheKey, function () {\n      return client.watchQuery(__assign(__assign({}, watchQueryOptions), {\n        variables: variables\n      }));\n    });\n    setQueryRef(wrapQueryRef(queryRef));\n  }, [query, queryKey, suspenseCache, watchQueryOptions, calledDuringRender]);\n  var reset = React.useCallback(function () {\n    setQueryRef(null);\n  }, [queryRef]);\n  return [loadQuery, queryRef, {\n    fetchMore: fetchMore,\n    refetch: refetch,\n    reset: reset\n  }];\n}","map":null,"metadata":{},"sourceType":"module"}